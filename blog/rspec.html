<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>blog.elizib.in</title>
    <meta name="description" content="Eli Zibin is a web developer in Vancouver BC">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Open Graph: Facebook -->
    <meta property="og:title" content="Eli Zibin ~ Web Developer">
    <meta property="og:url" content="http://elizib.in">
    <meta property="og:description" content="Eli Zibin is a web developer in Vancouver, BC.">
    <!-- Twitter Cards-->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:site" content="@elizibin">
    <meta property="twitter:title" content="Eli Zibin ~ Web Developer">
    <meta property="twitter:description" content="Eli Zibin is a web developer in Vancouver, BC.">
    <meta property="twitter:domain" content="http://elizib.in">
    <link rel="shortcut icon" href="../img/favicon.ico?v=2" />
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/main.min.css">
    <script src="../js/vendor/modernizr-2.8.3.min.js"></script>
    <script>
        document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
    </script>
</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <main class="bloghome container">
        <header class="row">
          <section class="text-center">
            <h1><a href="../index">{{ eli-zibin }}</a></h1>
            <h3><span class="up">select</span> *
                  <span class="up">from</span> <span class="flourish"><a href="all.html">blog posts</a></span>
                <span class="up">where</span> name = <span class="flourish">'Sinatra'</span>;
            </h3>
            </section>
        </header>

        <article class="row">
          <section class="blog-content col-md-8 col-md-offset-2">
              <img src="../img/rspec.png" alt="Rspec - Testing Framework of the Gods" class ="center-block img-repsonsive title-image">
              <p>We've spent a few days learning about benefits of <a href="https://en.wikipedia.org/wiki/Test-driven_development">Test-Driven Development</a> through the popular testing framework <a href="http://rspec.info/">rspec</a>. We use rspec in conjunction with <a href="https://github.com/thoughtbot/factory_girl_rails">Factory Girl</a> in order to create factories for testing with.</p>
              <script src="https://gist.github.com/zibs/2eb4e9388894b2ed47db.js"></script>
              <p>This factory will allows to reuse and recreate a Project object with the invocation of each test. Factories make code DRYer and easier to write/read. The Faker method calls ensure that our data is a little unpredictable, more interesting, and different each time, but it will still meet the valiations we've declared. Using a factory for a single controller is as easy as placing the call for the object at the top of the test suite: </p>
              <script src="https://gist.github.com/zibs/a4b3909aae9d22b5aa54.js"></script>
              <p>In this case, the <b>let</b> command will instantiate a new project object, an accessible variable for each test, every time the test suite is run. </p>
              <p>I'll post the entire test controller at the end of this post, but I'll through an action or two for each major action in this controller, which is a basic CRUD controller. </p>
              <p>The new action renders the new template, and also instantiates a new object, assigning it to an instance variable. The test could look something like this: </p>
<script src="https://gist.github.com/zibs/f65c77e3e34cbee7e0ae.js"></script>
              <p>And the corresponding controller action would look like: </p>
              <script src="https://gist.github.com/zibs/0e5f68a8005eedb6147f.js"></script>
              <p>Simple.</p>
              <p>The `create` action is a bit more complicated, and we get to use some more exciting rspec features. To test the <b>create</b> action we are going to want to test the action wtih both valid and invalid data, since we want to update the database with valid data, and render the <b>new</b> template upon receiving invalid data. </p>
              <p>Here we use rspec's <b>context</b> (which is an alias of describe), but allows us to be a bit more descriptive of what we are attempting to test. Within the context we can use a method which will initialize a new <b>Project</b> object with its appropriate parameters depending on the context. The method we're using <b>valid_post_request</b> also imitates the post request that we are intending to perform in this scenario. This makes it simple to execute within each test. Another option here would have been to use a <b>before each</b> block to make the post request before each test, but I will use that later on.</p>
              <script src="https://gist.github.com/zibs/7b71c32d90c036b63d28.js"></script>
              <p>We're able to check simple things like redirects, as well as querying the database to see if the valid or invalid post requests have indeed changed the database. </p>
              <p>This next one shows the use of the <b>before each</b> rspec block that lets us mimic an http request.</p>
              <script src="https://gist.github.com/zibs/fcb6af645fc010c4f99d.js"></script>
              <p>On actions that we expect an error to be raised, we can pass `expect` a block of code to be executed which we expect to raise the error, and then specify which error we're expecting as well, in this case <b>ActiveRecord::RecordNotFound</b></p>
              <p>Again, in the <b>action</b> we can use the <b>context</b> and the <b>before each</b> block to set up the update actions. An important thing to be aware of in this case is the need to use <b>reload</b> when checking if the object has actually updated in the database, or else it would check against the object in memory, which hasn't changed.</p>
              <script src="https://gist.github.com/zibs/f24ae30d9cb26ce28ebf.js"></script>
              <p>Finally, in the <b>destroy</b> action we can use the <b>!</b> band operator to override the previous `let` command and create an additional project which we will immediately delete. To check the deletion we can pass <b>expect</b> a block which issues the http request to the appropriate id and then checks it by passing <b>change</b> a block which counts if the database has indeed changed from the request. Cool stuff man. Rspec is fun. </p>
              <script src="https://gist.github.com/zibs/043cfd792bf086336a41.js"></script>


          </section>

    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>
        window.jQuery || document.write('<script src="../js/vendor/jquery-1.11.3.min.js"><\/script>')
    </script>
    <script src="../js/main.min.js"></script>
    <script>
        (function(b, o, i, l, e, r) {
            b.GoogleAnalyticsObject = l;
            b[l] || (b[l] =
                function() {
                    (b[l].q = b[l].q || []).push(arguments)
                });
            b[l].l = +new Date;
            e = o.createElement(i);
            r = o.getElementsByTagName(i)[0];
            e.src = 'https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e, r)
        }(window, document, 'script', 'ga'));
        ga('create', 'UA-55771414-8', 'auto');
        ga('send', 'pageview');
    </script>
</body>

</html>
